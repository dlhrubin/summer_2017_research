#Danielle Rubin
#
#Purpose: bash script for fetching LD matrices from LDmatrix site and saving them as .txt files
#
#Inputs: rsID_urls, a csv containing formatted urls for fetching LD matrices (generated by R script)
#
#Outputs: LD matrices from LDmatrix site formatted as .txt files

#!/bin/bash

#BSUB -n 1

#BSUB -W 10:00

#BSUB -J matrices_generator

#BSUB -q priority



#Reads rsID_urls.csv into variable rsID_urls

readarray rsID_urls < rsID_urls.csv

#Removes quotation marks from the url strings	

rsID_urls=("${rsID_urls[@]//\"/}")

#Iterates through list of url strings

for i in $(eval echo "{0..$((${#rsID_urls[@]} - 1))}")
do
	
	#Removes all white space from the url strings
	
	matrix_url="$(echo -e "${rsID_urls[$i]}" | tr -d '[:space:]')"
	
	#Code to programmatically access each LDmatrix (with the ith url string pasted in) and save it as a text file
	
	curl -k -X GET 'https://analysistools.nci.nih.gov/LDlink/LDlinkRest/ldmatrix?snps='$matrix_url'&pop=ALL&r2_d=r2' > $((${i}+1))_rsID_matrix.txt
done
